<Window x:Class="TaskManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Task Manager - Professional Edition" Height="700" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="White">

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Top Panel: Filters and Search -->
        <Border Grid.Row="0" Background="{StaticResource LightGrayBrush}" 
                Padding="15,12" CornerRadius="5" Margin="0,0,0,15">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="🔍 Filters:" VerticalAlignment="Center" 
                           FontWeight="SemiBold" Margin="0,0,15,0"/>

                <TextBlock Text="Status:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                <ComboBox Width="130" Margin="0,0,15,0"
                          Style="{StaticResource FilterComboBox}"
                          ItemsSource="{Binding StatusOptions}"
                          SelectedItem="{Binding SelectedStatus}">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Ellipse Width="8" Height="8" 
                                         Fill="{Binding Converter={StaticResource StatusToColorConverter}}" 
                                         Margin="0,0,5,0"/>
                                <TextBlock Text="{Binding}"/>
                            </StackPanel>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <TextBlock Text="Priority:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                <ComboBox Width="130" Margin="0,0,15,0"
                          Style="{StaticResource FilterComboBox}"
                          ItemsSource="{Binding PriorityOptions}"
                          SelectedItem="{Binding SelectedPriority}">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Ellipse Width="8" Height="8" 
                                         Fill="{Binding Converter={StaticResource PriorityToColorConverter}}" 
                                         Margin="0,0,5,0"/>
                                <TextBlock Text="{Binding}"/>
                            </StackPanel>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                <TextBox Width="250" Margin="0,0,10,0"
                         Style="{StaticResource SearchTextBox}"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         ToolTip="Search in title and description"/>
                <Button Content="🔍 Search" Width="90" 
                        Style="{StaticResource PrimaryButton}"
                        Command="{Binding SearchCommand}"/>

                <Button Content="✖ Clear" Width="90" Margin="10,0,0,0"
                        Style="{StaticResource SecondaryButton}"
                        Command="{Binding ClearFiltersCommand}"/>
            </StackPanel>
        </Border>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,15">
            <Button Content="➕ Add Task" Width="120" Margin="0,0,10,0"
                    Style="{StaticResource PrimaryButton}"
                    Command="{Binding AddTaskCommand}"/>
            <Button Content="✏️ Edit Task" Width="120" Margin="0,0,10,0"
                    Style="{StaticResource SecondaryButton}"
                    Command="{Binding EditTaskCommand}"/>
            <Button Content="🗑️ Delete Task" Width="120" Margin="0,0,15,0"
                    Style="{StaticResource DangerButton}"
                    Command="{Binding DeleteTaskCommand}"/>
            <Button Content="🔄 Refresh" Width="120" Margin="0,0,15,0"
                    Style="{StaticResource PrimaryButton}"
                    Command="{Binding LoadTasksCommand}"/>
            <Button Content="📊 Export CSV" Width="120" Margin="0,0,5,0"
                    Style="{StaticResource SecondaryButton}"
                    Command="{Binding ExportToCsvCommand}"/>
            <Button Content="📈 Export Excel" Width="120"
                    Style="{StaticResource SecondaryButton}"
                    Command="{Binding ExportToExcelCommand}"/>
        </StackPanel>

        <!-- Tasks DataGrid -->
        <Border Grid.Row="2" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="5">
            <DataGrid ItemsSource="{Binding Tasks}"
                      SelectedItem="{Binding SelectedTask}"
                      Style="{StaticResource MainDataGrid}"
                      ColumnHeaderStyle="{StaticResource DataGridHeaderStyle}">

                <DataGrid.Columns>
                    <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="220">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="Padding" Value="8,0"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTemplateColumn Header="Status" Width="120">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="8,0">
                                    <Ellipse Width="10" Height="10" 
                                             Fill="{Binding Status, Converter={StaticResource StatusToColorConverter}}" 
                                             Margin="0,0,8,0"/>
                                    <TextBlock Text="{Binding Status}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Header="Priority" Width="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="8,0">
                                    <Ellipse Width="10" Height="10" 
                                             Fill="{Binding Priority, Converter={StaticResource PriorityToColorConverter}}" 
                                             Margin="0,0,8,0"/>
                                    <TextBlock Text="{Binding Priority}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTextColumn Header="Assigned To" Binding="{Binding AssignedTo.Name}" Width="140">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Padding" Value="8,0"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <!-- Zastąp Due Date column tym prostszym kodem: -->
                    <DataGridTextColumn Header="Due Date" Binding="{Binding DueDate, StringFormat='{}{0:dd/MM/yyyy}'}" Width="100">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Padding" Value="8,0"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="Created" Binding="{Binding CreatedDateTime, StringFormat='{}{0:dd/MM/yyyy}'}" Width="100">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Padding" Value="8,0"/>
                                <Setter Property="Foreground" Value="#666666"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="Hours" Binding="{Binding EstimatedHours}" Width="70">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="TextAlignment" Value="Center"/>
                                <Setter Property="Padding" Value="8,0"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Padding" Value="8,0"/>
                                <Setter Property="TextWrapping" Value="Wrap"/>
                                <Setter Property="Foreground" Value="#555555"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="{StaticResource LightGrayBrush}" 
                CornerRadius="5" Margin="0,15,0,0" Padding="15,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="{Binding StatusMessage}" 
                           VerticalAlignment="Center" FontWeight="SemiBold"/>

                <TextBlock Grid.Column="1" 
                           Text="{Binding Tasks.Count, StringFormat='📋 {0} tasks'}"
                           VerticalAlignment="Center" 
                           Foreground="#666666" FontSize="12"/>
            </Grid>
        </Border>
    </Grid>
</Window>